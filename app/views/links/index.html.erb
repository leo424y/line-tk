<p id="notice"><%= notice %></p>

<%= link_to '💦 HILI.LINK 💧', root_path, style: "text-decoration:none;" %>
🦫 與海狸們集結四散的資訊樹枝，一起搭建我們的知識水庫。
<%= link_to '👉 Need help?', 'https://hackmd.io/@flab/hili', target: '_blank', style: "text-decoration:none;" %>
<p>海狸縮址有 chatbot 囉，歡迎<a href='https://line.me/R/ti/p/@460kalte'>點此加入</a>。本服務原始碼開放，歡迎到<a href='https://hackmd.io/@flab/hili/edit'>共筆</a>討論</p>
<img src='https://imgur.com/E1b6PDo.jpg'></img>
<% if params[:i] %>
<% if @hili.present? %>
<%= link_to @hili[:note], @hili[:full_url] %>
<button onclick="copyToClipboard('<%= @hili[:full_url] %>')">copy</button>
<p>random redirect to links:</p>
<table>
  <tbody>
    <% @links.each do |link| %>
    <tr>
      <td>
        <% hili = "#{link.url}#:~:text=#{link.note}" %>
        <%= link_to notify(link.note), hili, target: '_blank', style: "text-decoration:none; color:#{random_colors}" %>
        <button onclick="copyToClipboard('<%= hili %>')">copy</button>
      </td>
    </tr>
    <% end %>
  </tbody>
</table>
<% else %>
🦫 Wrong url: please do "https://hili.link?i=YOURNOTE https://YOURURL.TO.NOTE"
<% end %>
<% else %>
<p>🦫 Creat your own hili.link by visit <code>https://hili.link?i=YOURNOTE https://YOURURL.TO.NOTE</code></p>
<p>🦫 Or, input your notes with url below like: <code>YOURNOTE https://YOURURL.TO.NOTE</code> →→<button onclick="tryIt()">Try it!</button></p>

<div class="mt-4 sm:flex sm:max-w-md">
  <div data-controller="autocomplete" data-autocomplete-url-value="/autocomplete_links">
    <%= search_form_for @q do |f| %>
    <%= f.submit '🦫 HILI!' %>
    <%# f.label :url_or_note_cont %>
    <%= f.search_field :url_or_note_cont, 'data-autocomplete-target': "input", 'placeholder': 'Find or add ideas for...', id: 'hiliit' %>
    <ul data-autocomplete-target="results"></ul>
    <% end %>
  </div>
</div>


<!--
<h1>Lines</h1>
<%= link_to '+', new_link_path, style: "text-decoration:none; color:black" %>
-->

<!--
<table>
  <thead>
    <tr>
      <th>link-to-text</th>
      <th colspan="3"></th>
      <th>Url</th>
      <th>Note</th>
    </tr>
  </thead>
-->

  <tbody>
    <% @links.each do |link| %>
    <tr>
      <td>
        <%= link_to notify(link.note), "#{link.url}#:~:text=#{link.note}", target: '_blank', style: "text-decoration:none; color:#{random_colors}" %>
      </td>
<!--
      <td><%= link_to 'Show', link %></td>
      <td><%= link_to 'Edit', edit_link_path(link) %></td>
      <td><%= link_to 'Destroy', link, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      <td><%= link.url %></td>
      <td><%= notify link.note %></td>
-->
    </tr>
    <% end %>
  </tbody>
<!--

</table>

<br>
-->


<% end %>



<script type="text/javascript">
    function tryIt() {
      document.getElementById("hiliit").value= '🦫 Note links in 1s!https://hili.link'
    }

    function copyToClipboard(message) {
        var textArea = document.createElement("textarea");
        textArea.value = message;
        textArea.style.opacity = "0"; 
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();


        try {
            var successful = document.execCommand('copy');
            var msg = successful ? 'successful' : 'unsuccessful';
            alert(textArea.value+' was copied')
            //alert('Copying text command was ' + msg);
        } catch (err) {
            alert('Unable to copy value , error : ' + err.message);
        }

        document.body.removeChild(textArea);
    }

</script>
