<p id="notice"><%= notice %></p>

<% if params[:i] || params[:q]  %>
<% if @hili[:note].present? %>
<div class="my-1 mt-3 rounded-md shadow sm:mt-0">
  <a href="/"
    class="w-full flex items-center justify-center py-3 border border-transparent text-base font-medium rounded-md text-indigo-600 bg-white hover:bg-gray-50 md:py-4 md:text-lg ">
    <%= '再' if @hili[:url] %>製作一個 HILI!
  </a>
</div>
<% if @hili[:url].present? %>
<p class="mt-3 text-lg text-gray-500">
<%= "#{@hili[:url]} 已縮址為 #{@hili[:full_url]}"%>
</p>
<p class="mt-3 text-lg text-gray-500">
  點選 COPY 即可以複製到剪貼簿囉
</p>
<% else %>
<p class="mt-3 text-lg text-gray-500">
  有這個字的相關網址，點選 Copy 即可以複製到剪貼簿囉
</p>
<% end %>

<div class="my-1 mt-3 rounded-md shadow sm:mt-0">
  <a href="#" onclick="copyToClipboard('<%= @hili[:full_url] %>')"
    class="w-full flex items-center justify-center py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-500 md:py-4 md:text-lg ">
    Copy</a>
</div>
<div class="my-1 mt-3 rounded-md shadow sm:mt-0">
  <a href="#" onclick="copyToClipboard('<%= "[#{@hili[:note]}](#{@hili[:full_url]})" %>')"
    class="w-full flex items-center justify-center py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-500 md:py-4 md:text-lg ">
    Copy as Markdown</a>
</div>
<p>
<%= @hili[:note] %> 這個字的相關連結：
</p>

<% all_links_markdown = '' %>
<% @links.each do |link| %>
  <% hili = "#{link.url}#:~:text=#{link.note}" %>
  <% all_links_markdown += "[#{link.note}](#{hili}) " %>
<% end %>
<div class="my-1 mt-3 rounded-md shadow sm:mt-0">
  <a href="#" onclick="copyToClipboard('<%= all_links_markdown %>')"
    class="w-full flex items-center justify-center py-3 border border-transparent text-base font-medium rounded-md text-indigo-600 bg-white hover:bg-gray-50 md:py-4 md:text-lg ">
    Copy all Hili links search result as Markdown</a>
</div>

<% @links.each do |link| %>
<% hili = "#{link.url}#:~:text=#{link.note}" %>
<%= link_to notify(link.note), hili, target: '_blank', style: "text-decoration:none; color:#{random_colors}" %>
<div class="my-1 mt-3 rounded-md shadow sm:mt-0">
  <a href="#" onclick="copyToClipboard('<%= hili %>')"
    class="w-full flex items-center justify-center py-3 border border-transparent text-base font-medium rounded-md text-indigo-600 bg-white hover:bg-gray-50 md:py-4 md:text-lg ">
    Copy</a>
</div>

<div class="my-1 mt-3 rounded-md shadow sm:mt-0">
  <a href="#" onclick="copyToClipboard('<%= "[#{link.note}](#{hili})" %>')"
    class="w-full flex items-center justify-center py-3 border border-transparent text-base font-medium rounded-md text-indigo-600 bg-white hover:bg-gray-50 md:py-4 md:text-lg ">
    Copy as Markdown</a>
</div>

<% end %>

<% else %>

<% end %>
<% else %>

<div>
  <div data-controller="autocomplete" data-autocomplete-url-value="/autocomplete_links">
    <%= search_form_for @q do |f| %>
    <%= f.search_field :url_or_note_cont, 'data-autocomplete-target': "input", required: true, class: "block border w-full pl-5 py-3 text-base rounded-md placeholder-gray-500 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:flex-1 border-gray-300", 'placeholder': '查詢或製作短網址…', id: 'hiliit' %>
    <%= f.submit '🦫 🌳  HILI! 🌳 🦫', name: nil, class: "my-1 w-full flex items-center justify-center py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 md:py-4 md:text-lg md:px-10" %>
    <div class="my-1 mt-3 rounded-md shadow sm:mt-0">
      <a onclick="tryIt('🦫輸入你接著網址在這裡後在前輸入易聯想的字並點擊送出https://hili.link')" href="#"
        class="w-full flex items-center justify-center py-3 border border-transparent text-base font-medium rounded-md text-indigo-600 bg-white hover:bg-gray-50 md:py-4 md:text-lg ">
        製作範例
      </a>
    </div>
    <div class="my-1 mt-3 rounded-md shadow sm:mt-0">
      <a onclick="tryIt('輸入易聯想的字並點擊送出')" href="#"
        class="w-full flex items-center justify-center py-3 border border-transparent text-base font-medium rounded-md text-indigo-600 bg-white hover:bg-gray-50 md:py-4 md:text-lg ">
        搜尋範例
      </a>
    </div>
    <%# f.label :url_or_note_cont %>
    <ul data-autocomplete-target="results"></ul>
    <% end %>
  </div>
</div>

<tbody>
  <% @links.each do |link| %>
  <tr>
    <td>
      <%= link_to notify(link.note), "#{link.url}#:~:text=#{link.note}", target: '_blank', style: "text-decoration:none; color:#{random_colors}" %>
    </td>
  </tr>
  <% end %>
</tbody>


<div class="relative py-10">
  <h3 class="text-2xl font-extrabold text-gray-900 tracking-tight sm:text-3xl">
    幫助金魚腦快速記下好用連結
  </h3>
  <p class="mt-3 text-lg text-gray-500">
    只需要一個步驟，就能快速完成記錄與查詢
  </p>

  <dl class="mt-10 space-y-10">
    <div class="relative">
      <dt>
        <div class="absolute flex items-center justify-center h-12 w-12 rounded-md bg-indigo-500 text-white">
          <!-- Heroicon name: outline/globe-alt -->
          <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
            aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
          </svg>
        </div>
        <p class="ml-16 text-lg leading-6 font-medium text-gray-900">製作連結</p>
      </dt>
      <dd class="mt-2 ml-16 text-base text-gray-500">
        <p>
          🦫 在網址列輸入
          <code class='underline'>https://hili.link?i=要標記的字https://你的連結</code>
        </p>
        <p>
          🦫 或在搜尋框輸入
          <code class='underline'>要標記的字https://你的連結</code>
        </p>
        <p>
          🦫 或直接對著 <a class='underline' href='https://line.me/R/ti/p/@460kalte'>Hili Chatbot</a> 送出上面標記的連結也可以得到短網址
        </p>
      </dd>
    </div>

    <div class="relative">
      <dt>
        <div class="absolute flex items-center justify-center h-12 w-12 rounded-md bg-indigo-500 text-white">
          <!-- Heroicon name: outline/scale -->
          <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
            aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
          </svg>
        </div>
        <p class="ml-16 text-lg leading-6 font-medium text-gray-900">取得連結</p>
      </dt>
      <dd class="mt-2 ml-16 text-base text-gray-500">
        <p>
          🦫 在網址列入就能查詢想查的字。例如：<code class='underline'>https://hili.link/易聯想的字</code>
        </p>
        <p>
          🦫 或在搜尋框輸入
          <code class='underline'>要查的字</code>
        </p>
        <p>
          🦫 或直接對著 <a class='underline' href='https://line.me/R/ti/p/@460kalte'>Hili Chatbot</a> 送出字也可得到連結
        </p>
      </dd>
    </div>

    <div class="relative">
      <dt>
        <div class="absolute flex items-center justify-center h-12 w-12 rounded-md bg-indigo-500 text-white">
          <!-- Heroicon name: outline/lightning-bolt -->
          <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
            aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
          </svg>
        </div>
        <p class="ml-16 text-lg leading-6 font-medium text-gray-900">發現更多連結</p>
      </dt>
      <dd class="mt-2 ml-16 text-base text-gray-500">
        直接輸入想找的資訊，看看有什麼最新連結！
      </dd>
    </div>
  </dl>
</div>
<% end %>



<script type="text/javascript">
  function tryIt(e) {
    document.getElementById("hiliit").value = e
  }

  function copyToClipboard(message) {
    var textArea = document.createElement("textarea");
    textArea.value = message;
    textArea.style.opacity = "0";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();


    try {
      var successful = document.execCommand('copy');
      var msg = successful ? 'successful' : 'unsuccessful';
      alert(textArea.value + ' 已複製到剪貼簿！可以到處貼上與分享囉')
      //alert('Copying text command was ' + msg);
    } catch (err) {
      alert('Unable to copy value , error : ' + err.message);
    }

    document.body.removeChild(textArea);
  }
</script>
